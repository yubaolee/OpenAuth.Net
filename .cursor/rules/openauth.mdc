---
alwaysApply: false
---
# OpenAuth.Net Cursor Rules

## é¡¹ç›®æ¦‚è¿°
OpenAuth.Netæ˜¯ä¸€ä¸ªåŸºäº.NET 9çš„ä¼ä¸šçº§æƒé™ç®¡ç†å’Œå¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œé‡‡ç”¨Martin Fowlerä¼ä¸šçº§åº”ç”¨å¼€å‘æ€æƒ³ï¼Œé›†æˆäº†æœ€æ–°çš„æŠ€æœ¯æ ˆã€‚

## æŠ€æœ¯æ ˆ
- **åç«¯**: .NET 9, ASP.NET Core WebAPI
- **ORM**: SqlSugar (ä¸»è¦) + Entity Framework Core (å…¼å®¹)
- **ä¾èµ–æ³¨å…¥**: Autofac
- **æ•°æ®åº“**: æ”¯æŒSqlServerã€MySQLã€Oracleã€PostgreSQL
- **å®šæ—¶ä»»åŠ¡**: Quartz.NET
- **ç¼“å­˜**: Redis, MemoryCache
- **å‰ç«¯**: Vue2 + Element-UI
- **æµ‹è¯•**: NUnit
- **æ–‡æ¡£**: Swagger

## é¡¹ç›®æ¶æ„
```
ğŸ“¦OpenAuth.Net
 â”£ ğŸ“‚Infrastructure       # åŸºç¡€è®¾æ–½å±‚ - å·¥å…·ç±»ã€æ‰©å±•æ–¹æ³•ã€å¸®åŠ©ç±»
 â”£ ğŸ“‚OpenAuth.Repository  # æ•°æ®è®¿é—®å±‚ - å®ä½“å®šä¹‰ã€æ•°æ®è®¿é—®
 â”£ ğŸ“‚OpenAuth.App         # åº”ç”¨æœåŠ¡å±‚ - ä¸šåŠ¡é€»è¾‘
 â”£ ğŸ“‚OpenAuth.WebApi      # è¡¨ç¤ºå±‚ - WebAPIæ§åˆ¶å™¨
 â”£ ğŸ“‚OpenAuth.Identity    # èº«ä»½è®¤è¯æœåŠ¡ - IdentityServer4
 â”£ ğŸ“‚Vue2                 # å‰ç«¯é¡¹ç›®
 â”— ğŸ“‚æ•°æ®åº“è„šæœ¬           # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
```

## ç¼–ç è§„èŒƒ

### é€šç”¨è§„èŒƒ
- ä½¿ç”¨C# 9+è¯­æ³•ç‰¹æ€§
- éµå¾ªMicrosoft C#ç¼–ç è§„èŒƒ
- ç±»åä½¿ç”¨PascalCaseï¼Œæ–¹æ³•åä½¿ç”¨PascalCase
- ç§æœ‰å­—æ®µä½¿ç”¨_camelCaseï¼Œå…¬å…±å±æ€§ä½¿ç”¨PascalCase
- å¸¸é‡ä½¿ç”¨UPPER_CASE
- å¼‚æ­¥æ–¹æ³•å¿…é¡»æ·»åŠ Asyncåç¼€

### å‘½åè§„èŒƒ
- **Controller**: ä»¥Controllerç»“å°¾ï¼Œå¦‚`UsersController`
- **Service/App**: ä»¥Appç»“å°¾ï¼Œå¦‚`UserManagerApp`
- **Repository**: ä»¥Repositoryç»“å°¾ï¼Œå¦‚`UserRepository`
- **Entity**: å®ä½“ç±»ç›´æ¥ä½¿ç”¨åè¯ï¼Œå¦‚`SysUser`
- **Request**: è¯·æ±‚ç±»ä»¥Reqç»“å°¾ï¼Œå¦‚`QueryUserListReq`
- **Response**: å“åº”ç±»ä»¥Respç»“å°¾ï¼Œå¦‚`PagedListDataResp`
- **DTO**: è§†å›¾æ¨¡å‹ä»¥Viewç»“å°¾ï¼Œå¦‚`UserView`

### æ³¨é‡Šè§„èŒƒ
- æ‰€æœ‰å…¬å…±æ–¹æ³•å¿…é¡»æ·»åŠ XMLæ³¨é‡Š
- å¤æ‚ä¸šåŠ¡é€»è¾‘å¿…é¡»æ·»åŠ è¡Œå†…æ³¨é‡Š
- ä½¿ç”¨/// <summary>æ ‡è®°æ–¹æ³•è¯´æ˜
- å‚æ•°ä½¿ç”¨/// <param name="å‚æ•°å">è¯´æ˜</param>
- è¿”å›å€¼ä½¿ç”¨/// <returns>è¯´æ˜</returns>

## åˆ†å±‚æ¶æ„è§„åˆ™

### Infrastructureå±‚ (åŸºç¡€è®¾æ–½å±‚)
- **èŒè´£**: æä¾›é€šç”¨å·¥å…·ç±»ã€æ‰©å±•æ–¹æ³•ã€å¸®åŠ©ç±»ã€å¸¸é‡å®šä¹‰
- **è§„åˆ™**: 
  - ä¸ä¾èµ–å…¶ä»–ä¸šåŠ¡å±‚
  - æä¾›å¯å¤ç”¨çš„åŸºç¡€åŠŸèƒ½
  - åŒ…å«ç¼“å­˜ã€é…ç½®ã€å·¥å…·ç±»ç­‰
- **æ–‡ä»¶ç»„ç»‡**: 
  - `/Cache` - ç¼“å­˜ç›¸å…³
  - `/Extensions` - æ‰©å±•æ–¹æ³•
  - `/Helpers` - å¸®åŠ©ç±»
  - `/Const` - å¸¸é‡å®šä¹‰

### Repositoryå±‚ (æ•°æ®è®¿é—®å±‚)
- **èŒè´£**: æ•°æ®è®¿é—®ã€å®ä½“å®šä¹‰ã€æ•°æ®åº“æ“ä½œ
- **è§„åˆ™**:
  - ç»§æ‰¿è‡ª`BaseRepository<T,TContext>`
  - å®ä½“ç±»ç»§æ‰¿è‡ª`StringEntity`ã€`LongEntity`æˆ–`IntAutoGenEntity`
  - ä½¿ç”¨SqlSugaræˆ–EF Coreè¿›è¡Œæ•°æ®è®¿é—®
  - åŒ…å«DbContexté…ç½®
- **åŸºç±»ä½¿ç”¨**:
  - `StringEntity`: å­—ç¬¦ä¸²ä¸»é”®å®ä½“
  - `LongEntity`: é•¿æ•´å‹ä¸»é”®å®ä½“  
  - `IntAutoGenEntity`: è‡ªå¢æ•´å‹ä¸»é”®å®ä½“

### Appå±‚ (åº”ç”¨æœåŠ¡å±‚)
- **èŒè´£**: ä¸šåŠ¡é€»è¾‘å¤„ç†ã€æ•°æ®ä¼ è¾“å¯¹è±¡ã€ä¸šåŠ¡è§„åˆ™
- **è§„åˆ™**:
  - ç»§æ‰¿è‡ª`SqlSugarBaseApp<T>`ã€`BaseStringApp<T>`ã€`BaseLongApp<T>`ç­‰åŸºç±»
  - é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
  - å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œä¸ç›´æ¥æ“ä½œæ•°æ®åº“
  - ä½¿ç”¨Request/Responseæ¨¡å¼
- **ä¾èµ–æ³¨å…¥**:
  ```csharp
  public UserManagerApp(ISqlSugarClient client, RevelanceManagerApp app, IAuth auth) 
      : base(client, auth)
  ```

### WebApiå±‚ (è¡¨ç¤ºå±‚)
- **èŒè´£**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€å“åº”æ ¼å¼åŒ–
- **è§„åˆ™**:
  - ç»§æ‰¿è‡ª`ControllerBase`
  - ä½¿ç”¨`[ApiController]`ç‰¹æ€§
  - ç»Ÿä¸€è¿”å›`Response<T>`æ ¼å¼
  - è¿›è¡Œå‚æ•°éªŒè¯
  - æ·»åŠ Swaggeræ–‡æ¡£æ³¨é‡Š

## æ•°æ®åº“æ“ä½œè§„èŒƒ

### SqlSugarä½¿ç”¨è§„èŒƒ
```csharp
// æŸ¥è¯¢
var users = SugarClient.Queryable<SysUser>()
    .Where(u => u.Status == 1)
    .ToList();

// åˆ†é¡µæŸ¥è¯¢
var result = new PagedListDataResp<Role>();
var objs = SugarClient.Queryable<Role>();
if (!string.IsNullOrEmpty(request.key))
{
    objs = objs.Where(u => u.Name.Contains(request.key));
}

result.Data = await objs.OrderBy(u => u.Name)
    .Skip((request.page - 1) * request.limit)
    .Take(request.limit).ToListAsync();
result.Count = await objs.CountAsync();
return result;

// è”è¡¨æŸ¥è¯¢
 var result = SugarClient.Queryable<Relevance>()
                .LeftJoin<SysOrg>((u, o) => u.SecondId == o.Id)
                .Where((u, o) => u.FirstId == userId && u.RelKey == Define.USERORG)
                .Select((u, o) => o);
    return result.ToList();
```

### äº‹åŠ¡å¤„ç†
```csharp
SugarClient.Ado.BeginTran();
try
{
    // æ•°æ®åº“æ“ä½œ
    SugarClient.Ado.CommitTran();
}
catch
{
    SugarClient.Ado.RollbackTran();
    throw;
}
```

## æƒé™å’Œå®‰å…¨è§„èŒƒ

### æƒé™éªŒè¯
- ä½¿ç”¨`IAuth`æ¥å£è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- é€šè¿‡`_auth.GetCurrentUser()`è·å–ç™»å½•ç”¨æˆ·
- æ•°æ®æƒé™é€šè¿‡æœºæ„çº§è”æ§åˆ¶

## APIè®¾è®¡è§„èŒƒ

### æ§åˆ¶å™¨è®¾è®¡
```csharp
[ApiController]
[Route("api/[controller]")]
public class UsersController : ControllerBase
{
    private readonly UserManagerApp _app;
    
    public UsersController(UserManagerApp app)
    {
        _app = app;
    }
    
    /// <summary>
    /// è·å–ç”¨æˆ·åˆ—è¡¨
    /// </summary>
    [HttpGet]
    public async Task<Response<PagedListDataResp<UserView>>> Get([FromQuery] QueryUserListReq request)
    {
        var result = await _app.Load(request);
        return Response.Ok(result);
    }
}
```

## ä¾èµ–æ³¨å…¥è§„èŒƒ

### Autofacé…ç½®
- åœ¨`AutofacExt.cs`ä¸­é…ç½®ä¾èµ–æ³¨å…¥
- å®ç°`IDependency`æ¥å£çš„ç±»è‡ªåŠ¨æ³¨å†Œ
- ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥

## æµ‹è¯•è§„èŒƒ

### å•å…ƒæµ‹è¯•
- ä½¿ç”¨NUnitæ¡†æ¶
- ç»§æ‰¿è‡ª`TestBase`åŸºç±»
- æµ‹è¯•ç±»ä»¥Testç»“å°¾
- æµ‹è¯•æ–¹æ³•ä½¿ç”¨æè¿°æ€§åç§°

### é›†æˆæµ‹è¯•
- ä½¿ç”¨`AutofacWebApplicationFactory`
- æ¨¡æ‹ŸHTTPè¯·æ±‚
- éªŒè¯å®Œæ•´çš„ä¸šåŠ¡æµç¨‹

## å·¥ä½œæµè§„èŒƒ

### æµç¨‹å®šä¹‰
- ä½¿ç”¨`FlowScheme`å®šä¹‰æµç¨‹æ¨¡æ¿
- é€šè¿‡`FlowInstance`ç®¡ç†æµç¨‹å®ä¾‹
- `FlowNode`è¡¨ç¤ºæµç¨‹èŠ‚ç‚¹

### æµç¨‹å¼•æ“
- ä½¿ç”¨`FlowRuntime`æ‰§è¡Œæµç¨‹
- æ”¯æŒé¡ºåºã€å¹¶è¡Œã€æ¡ä»¶ç­‰æµç¨‹ç±»å‹
- æµç¨‹çŠ¶æ€é€šè¿‡`FlowInstanceStatus`ç®¡ç†

## å®šæ—¶ä»»åŠ¡è§„èŒƒ

### Quartzä½¿ç”¨
- ç»§æ‰¿è‡ª`IJob`æ¥å£
- åœ¨`QuartzService`ä¸­æ³¨å†Œä»»åŠ¡
- æ”¯æŒCronè¡¨è¾¾å¼é…ç½®

## æ–‡æ¡£è§„èŒƒ

### ä»£ç æ–‡æ¡£
- é‡è¦ä¸šåŠ¡é€»è¾‘æ·»åŠ æ³¨é‡Š
- å¤æ‚ç®—æ³•æ·»åŠ è¯´æ˜
- é…ç½®æ–‡ä»¶æ·»åŠ è¯´æ˜æ³¨é‡Š

## é…ç½®ç®¡ç†

### é…ç½®æ–‡ä»¶
- `appsettings.json`: åŸºç¡€é…ç½®
- `appsettings.Development.json`: å¼€å‘ç¯å¢ƒé…ç½®
- `appsettings.Production.json`: ç”Ÿäº§ç¯å¢ƒé…ç½®
